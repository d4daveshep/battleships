<div id="player-board-component" {% if oob %}hx-swap-oob="true"{% endif %}>
    {# Build a lookup map of cell -> ship data for quick access #}
    {% set cell_to_ship = {} %}
    {% if player_board and player_board.ships %}
        {% for ship_name, ship_data in player_board.ships.items() %}
            {% for cell in ship_data.cells %}
                {% set _ = cell_to_ship.update({cell: {"name": ship_name, "code": ship_data.code}}) %}
            {% endfor %}
        {% endfor %}
    {% endif %}
    
    {# Get shots_received dict (coord -> round_number) #}
    {% set shots_received = player_board.shots_received if player_board and player_board.shots_received else {} %}
    
    {# 10x10 Grid Visualization #}
    <table data-testid="player-board" class="ship-grid">
        <thead>
            <tr>
                <th></th>
                {% for col in range(1, 11) %}
                <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% set rows = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'] %}
            {% for row in rows %}
            <tr>
                <th>{{ row }}</th>
                {% for col in range(1, 11) %}
                    {% set coord = row ~ col %}
                    {% set ship_data = cell_to_ship.get(coord) %}
                    {% set is_hit = coord in shots_received %}
                    <td data-testid="player-cell-{{ coord }}" 
                        class="ship-grid-cell {% if is_hit %}cell--hit{% endif %}"
                        {% if ship_data %}data-ship="{{ ship_data.name.lower() }}"{% endif %}>
                        {% if is_hit %}
                            {# Show incoming shot marker with round number #}
                            <span class="incoming-shot" aria-label="Hit in round {{ shots_received[coord] }}">
                                {% if ship_data %}{{ ship_data.code }}{% endif %}<sub>{{ shots_received[coord] }}</sub>
                            </span>
                        {% elif ship_data %}
                            {# Show ship code (A=Carrier, B=Battleship, C=Cruiser, S=Submarine, D=Destroyer) #}
                            {{ ship_data.code }}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {# Ship Legend #}
    <div class="ship-legend">
        <strong>Ship Legend:</strong>
        <div class="legend-item">
            <span class="legend-color carrier"></span>
            <span>A = Carrier (5 cells)</span>
        </div>
        <div class="legend-item">
            <span class="legend-color battleship"></span>
            <span>B = Battleship (4 cells)</span>
        </div>
        <div class="legend-item">
            <span class="legend-color cruiser"></span>
            <span>C = Cruiser (3 cells)</span>
        </div>
        <div class="legend-item">
            <span class="legend-color submarine"></span>
            <span>S = Submarine (3 cells)</span>
        </div>
        <div class="legend-item">
            <span class="legend-color destroyer"></span>
            <span>D = Destroyer (2 cells)</span>
        </div>
    </div>
</div>