{# Round Results Component - Shows results after both players fire #}
<div class="round-results" data-testid="round-results">
    <h2>Round {{ round_number }} Complete!</h2>
    
    <div class="hits-made">
        {% if my_hits %}
            <h3>Hits Made This Round:</h3>
            <ul>
            {% for ship_name, hit_count in my_hits.items() %}
                <li>{{ ship_name }}: {{ hit_count }} hit{% if hit_count != 1 %}s{% endif %}</li>
            {% endfor %}
            </ul>
        {% else %}
            <p data-testid="no-hits-made"><strong>Hits Made This Round:</strong> None</p>
        {% endif %}
        
        {% if ships_sunk_by_me %}
            {% for ship_type in ships_sunk_by_me %}
                <p class="ship-sunk-message">You sunk their {{ ship_type.ship_name }}!</p>
            {% endfor %}
        {% endif %}
    </div>
    
    <div class="hits-received">
        <h3>Hits Received This Round:</h3>
        {% if opponent_hits %}
            <ul>
            {% for ship_name, hit_count in opponent_hits.items() %}
                <li>Your {{ ship_name }} was hit {{ hit_count }} time{% if hit_count != 1 %}s{% endif %}
                {% if opponent_hit_details %}
                    at: 
                    {% set ship_coords = [] %}
                    {% for hit in opponent_hit_details %}
                        {% if hit.ship_type.ship_name == ship_name %}
                            {% set _ = ship_coords.append(hit.coord.name) %}
                        {% endif %}
                    {% endfor %}
                    {{ ship_coords | join(', ') }}
                {% endif %}
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <p>Opponent missed all shots</p>
        {% endif %}
        
        {% if ships_sunk_by_opponent %}
            {% for ship_type in ships_sunk_by_opponent %}
                <p class="ship-sunk-message">Your {{ ship_type.ship_name }} was sunk!</p>
            {% endfor %}
        {% endif %}
    </div>

    {% if game_over %}
        <div class="game-over-message alert {% if is_draw %}alert-warning{% elif winner_id == player_id %}alert-success{% else %}alert-danger{% endif %}" data-testid="game-over-message">
            {% if is_draw %}
                <h2>Draw!</h2>
                <p>Both players sunk all ships in the same round</p>
            {% elif winner_id == player_id %}
                <h2>You Win!</h2>
                <p>All opponent ships destroyed!</p>
            {% else %}
                <h2>You Lose!</h2>
                <p>All your ships destroyed!</p>
            {% endif %}
            
            <div class="mt-3">
                <a href="/lobby" class="btn btn-primary" hx-boost="true">Return to Lobby</a>
            </div>
        </div>
    {% else %}
        <button hx-get="/game/{{ game_id }}/aiming-interface?clear_round=true"
                hx-target="#aiming-interface"
                hx-swap="innerHTML"
                class="btn btn-primary">
            Continue to Round {{ round_number + 1 }}
        </button>
    {% endif %}

    <div class="game-stats mt-3">
        <p data-testid="ships-sunk"><strong>Ships Sunk:</strong> {{ ships_sunk_count }}/5</p>
        <p data-testid="ships-lost"><strong>Ships Lost:</strong> {{ ships_lost_count }}/5</p>
    </div>
</div>
