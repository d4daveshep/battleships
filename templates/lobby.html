{% extends "base.html" %}

{% block title %}Multiplayer Lobby{% endblock %}

{% block content %}
<div data-testid="lobby-container">
    <h1>Multiplayer Lobby</h1>
    
    <div data-testid="player-name">
        <h3>Welcome, {{ player_name }}!</h3>
    </div>
    
    <div data-testid="player-status">
        Your Status: {{ player_status }}
    </div>
    
    {% if confirmation_message %}
    <div data-testid="confirmation-message">
        {{ confirmation_message }}
    </div>
    <!-- Auto-redirect to game page after showing confirmation -->
    <!-- <meta http-equiv="refresh" content="2;url=/game?player_name={{ player_name }}"> -->
    {% endif %}

    {% if decline_confirmation_message %}
    <div data-testid="decline-confirmation-message">
        {{ decline_confirmation_message }}
    </div>
    {% endif %}

    {% if pending_request %}
    <div data-testid="game-request-notification">
        Game request from {{ pending_request.sender }}
        <form hx-post="/accept-game-request" hx-target="body" hx-swap="innerHTML" style="display: inline;">
            <input type="hidden" name="player_name" value="{{ player_name }}">
            <input type="hidden" name="show_confirmation" value="true">
            <button type="submit" data-testid="accept-game-request">Accept</button>
        </form>
        <form method="post" action="/decline-game-request" style="display: inline;">
            <input type="hidden" name="player_name" value="{{ player_name }}">
            <input type="hidden" name="show_confirmation" value="true">
            <button type="submit" data-testid="decline-game-request">Decline</button>
        </form>
    </div>
    {% endif %}

    <!-- Available Players section -->
    <div data-testid="available-players-list" 
         hx-get="/lobby/players/{{ player_name }}" 
         hx-trigger="load, every 1s" 
         hx-swap="innerHTML">
    </div>
    
    <!-- Leave Lobby Section -->
    <div data-testid="leave-lobby-section">
        <!-- <form hx-post="/leave-lobby" hx-target="body" hx-swap="innerHTML"> -->
        <form method="post" action="/leave-lobby" >
            <input type="hidden" name="player_name" value="{{ player_name }}">
            <button type="submit" data-testid="leave-lobby-button">
                Leave Lobby
            </button>
        </form>
    </div>
    
</div>
{% endblock %}
